"use strict";const G_L=new LangData("ssl-lang");async function ssl_reissueByIds(e,s){if(!params_Validate(s,"e",3))return;if("modal-submit"!==e.target.id)return;const l=new ButtonState("modal-submit"),t=await fetchText_Post(s[0]+"&t="+csrf_getPageToken(),s[1]);l.restore(),isFetchedOk(t,s[2])}async function ssl_openReissueWnd(e,s){if(!params_Validate(s,"e",8))return;const l=s[0],t=s[1],n=s[2],a=s[3],c=s[4],o=s[5],i=s[6],r=s[7],d=['<div class="row jc-between h-2"><p class="modal-title">'+a+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>\n'],u=table_getSelectedIds(l);if(u.length<1)return void notificationNew_addError("no items selected");d.push('<p class="d-block m-t1 c-yellow">'+c+"</p>\n"),d.push('<p class="d-block m-b1 c-yellow">'+o+"</p>\n"),d.push('<p class="d-block m-t1 m-b1">'+i+":</p>\n");const p=Array();for(let e=0;e<u.length;e+=1)p.push('"'+u[e].dataId+'"');d.push('<textarea class="w-100p h-5" readonly>'+Html.escape(p.join(" "))+"</textarea>"),d.push('<a id="modal-submit" class="btn">'+r+"</a>");const m=document.getElementById("modal-content");m&&(m.innerHTML=d.join("\n"));const _=document.getElementById("modal-popup");_&&(_.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close);const y=[];for(let e=0;e<u.length;e+=1)y.push(u[e].id);let f=y.join(",");f="'"+f.replaceAll("'","%QUO%")+"'",listener_AddSingleById("modal-submit","mouseup","keyup","Enter",ssl_reissueByIds,t,f,n)}async function ssl_hostCertTypeSelector(e,s){const l=document.querySelector("label[for=ssl-misc-host-privkey]"),t=document.getElementById("ssl-misc-host-privkey"),n=document.querySelector("label[for=ssl-misc-host-fullchain]"),a=document.getElementById("ssl-misc-host-fullchain");if(!(l&&t&&n&&a))return;const c=document.getElementById("ssl-misc-host-custom"),o=c&&c.checked;enableClass_DBlock(l,o),enableClass_DBlock(t,o),enableClass_DBlock(n,o),enableClass_DBlock(a,o)}async function ssl_Misc_Confirm(e,s){const l=new PrepData(4);let t=!1;if(l.prepareValue(0,"#ssl-misc-hostname",!0,G_L.raw("hostname")+" "+G_L.raw("is required"))||(t=!0),l.prepareRadio(1,["#ssl-misc-host-ss","#ssl-misc-host-le","#ssl-misc-host-custom"])||(t=!0),t)return;if("'custom'"===l.arr[1]&&(l.prepareValue(2,"#ssl-misc-host-privkey",!0,G_L.raw("private key data")+" "+G_L.raw("is required"))||(t=!0),l.prepareValue(3,"#ssl-misc-host-fullchain",!0,G_L.raw("certificate data")+" "+G_L.raw("is required"))||(t=!0),t))return;const n="ssl-misc-confirm",a=new ButtonState(n),c=await fetchText_Post("/ssl/?a="+n,l.arr.join(" "));a.restore(),isFetchedOk(c,"/ssl/")}async function ssl_Misc_Ip_Confirm(e,s){const l="ssl-misc-ip-confirm",t=new ButtonState(l),n=await fetchText_Post("/ssl/?a="+l,"'ip'");console.log("data",n),t.restore(),isFetchedOk(n,"/ssl/?a=ssl-misc")}async function ssl_panelCertTypeSelector(e,s){const l=document.querySelector("label[for=ssl-panel-panel-privkey]"),t=document.getElementById("ssl-panel-panel-privkey"),n=document.querySelector("label[for=ssl-panel-panel-fullchain]"),a=document.getElementById("ssl-panel-panel-fullchain");if(!(l&&t&&n&&a))return;const c=document.getElementById("ssl-panel-panel-custom"),o=c&&c.checked;enableClass_DBlock(l,o),enableClass_DBlock(t,o),enableClass_DBlock(n,o),enableClass_DBlock(a,o)}async function ssl_Panel_Confirm(e,s){const l=new PrepData(3);let t=!1;if(l.prepareRadio(0,["#ssl-panel-panel-ss","#ssl-panel-panel-custom"])||(t=!0),t)return;if("'custom'"===l.arr[0]&&(l.prepareValue(1,"#ssl-panel-panel-privkey",!0,G_L.raw("private key data")+" "+G_L.raw("is required"))||(t=!0),l.prepareValue(2,"#ssl-panel-panel-fullchain",!0,G_L.raw("certificate data")+" "+G_L.raw("is required"))||(t=!0),t))return;const n="ssl-panel-confirm",a=new ButtonState(n),c=await fetchText_Post("/ssl/?a="+n,l.arr.join(" "));a.restore(),isFetchedOk(c,"/ssl/")}async function ssl_Log_Show(e,s){const l=document.querySelector("#ssl-log-200"),t=document.querySelector("#ssl-log-500"),n=document.querySelector("#ssl-log-1000");let a="50";l&&l.checked?a="200":t&&t.checked?a="500":n&&n.checked&&(a="1000"),window.location="/ssl/?a=ssl-log&rows="+a}common_listeners(),listener_AddSingleById("ssl-reissue-wnd","click","keyup","Enter",ssl_openReissueWnd,"tbl-ssl","/ssl/?a=ssl-reissue","/ssl/",G_L.esc("Re-issue certificates"),G_L.esc("Only selected certificates for active sites and mail domains will be reissued,"),G_L.esc("custom certificates are ignored"),G_L.esc("Next items will be deleted"),G_L.esc("Confirm")),listener_AddSingleById("ssl-info","click","keyup","Enter",table_OnButtonClick_Router,"tbl-ssl","/ssl/?a=ssl-info&ssl=",""),listener_AddSingleById("ssl-delete-wnd","click","keyup","Enter",table_openDeleteWnd,"tbl-ssl","/ssl/?a=ssl-delete","/ssl/",G_L.esc("Delete")+" "+G_L.esc("ssl certificates"),G_L.esc("Next items will be deleted"),G_L.esc("Confirm"),'<p class="d-block m-t1 m-b1 c-yellow f-1">'+G_L.esc("certificates, attached to site or mail domain, will be ignored.")+"</p>\n"),listener_AddSingleById("ssl-misc-host-ss","change",null,null,ssl_hostCertTypeSelector),listener_AddSingleById("ssl-misc-host-le","change",null,null,ssl_hostCertTypeSelector),listener_AddSingleById("ssl-misc-host-custom","change",null,null,ssl_hostCertTypeSelector),listener_AddSingleById("ssl-misc-confirm","click","keyup","Enter",ssl_Misc_Confirm),listener_AddSingleById("ssl-misc-ip-confirm","click","keyup","Enter",ssl_Misc_Ip_Confirm),listener_AddSingleById("ssl-panel-panel-ss","change",null,null,ssl_panelCertTypeSelector),listener_AddSingleById("ssl-panel-panel-custom","change",null,null,ssl_panelCertTypeSelector),listener_AddSingleById("ssl-panel-confirm","click","keyup","Enter",ssl_Panel_Confirm),listener_AddSingleById("ssl-log-show","click","keyup","Enter",ssl_Log_Show),listeners_Add("table.tbl-fixed tbody","tr","mouseup",null,null,table_OnClickRouter,"/ssl/?a=ssl-info&ssl="),listener_AddSingleById("ssl-name-sort","click",null,null,table_Sort,"/ssl/","ssl-table-sort","sort-no,sort-name-az,sort-name-za"),listener_AddSingleById("ssls-checkbox-header","mouseup",null,null,table_SetAllCheckboxes,"table#tbl-ssl tbody tr td .checkbox-simple-cntr input[type=checkbox]"),listeners_Add(null,".pageidx","click",null,null,table_SelectPage,"ssl-table-page","/ssl/"),listener_AddSingleById("ssl-table-setting","click","keyup","Enter",tableSetting_Modal_OpenWnd,JSON.stringify({id:"ssl-table-setting",cookie:"ssl-table-setting",path:"/ssl/",titles:[G_L.esc("Settings"),G_L.esc("Number of rows"),G_L.esc("custom"),G_L.esc("Confirm")],values:[1,2,4,8],names:["name","expdate","certtype","location"],labels:[G_L.esc("name"),G_L.esc("expiration date"),G_L.esc("type"),G_L.esc("location")]}));