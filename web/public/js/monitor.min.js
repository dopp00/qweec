"use strict";async function monitor_fetchPng_Get(e,t){let o=await fetch(window.location.protocol+"//"+window.location.host+e,{method:"GET",mode:"same-origin",cache:"no-cache",headers:{Accept:'Accept": "image/png',"Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, HEAD"}}).catch((e=>console.log(e)));if(200===o.status){if("image/png"===o.headers.get("Content-Type").toLowerCase()){const e=await o.blob();if(e){let o=window.URL.createObjectURL(e);return document.getElementById(t).src=o,"OK"}}}return enableClass_DBlock(document.getElementById(t),!1),enableClass_DBlock(document.getElementById(t+"-not-found"),!0),notificationNew_addError("failed to set image"),null}function monitor_determineDs(e){return e.endsWith("disk")?"disk":e.endsWith("exim")?"exim":e.endsWith("la")?"la":e.endsWith("mem")?"mem":e.endsWith("mysql")?"mysql":e.endsWith("net")?"net":e.endsWith("nginx")?"nginx":""}async function monitor_periodChange_PngGet(e,t){const o=monitor_determineDs(e.target.id);if(!o||"string"!=typeof o||o.length<1)return void console.log("failed to determine ds");let n="";if(e.target.id.startsWith("monitor-day"))n="day";else if(e.target.id.startsWith("monitor-week"))n="week";else if(e.target.id.startsWith("monitor-month"))n="month";else{if(!e.target.id.startsWith("monitor-year"))return void console.log("failed to determine period");n="year"}const i=document.getElementById("monitor-sel-"+o),r=i?i.value:"",c=await monitor_fetchPng_Get("/monitor/?a=monitor-img-get&ds="+encodeURIComponent(o)+"&db="+encodeURIComponent(r)+"&period="+encodeURIComponent(n),"monitor-img-"+o);isFetchedDataValid(c)}async function monitor_dbSelectorChange_PngGet(e,t){const o=monitor_determineDs(e.target.id);if(!o||"string"!=typeof o||o.length<1)return void console.log("failed to determine ds");let n="";const i=document.getElementById("monitor-day-"+o),r=document.getElementById("monitor-week-"+o),c=document.getElementById("monitor-month-"+o),d=document.getElementById("monitor-year-"+o);if(!(i&&r&&c&&d))return"";if(i.checked)n="day";else if(r.checked)n="week";else if(c.checked)n="month";else{if(!d.checked)return void console.log("failed to determine period");n="year"}const m=document.getElementById(e.target.id),l=m?m.value:"";if(l.length<1)return void console.log("failed to determine db");const s=await monitor_fetchPng_Get("/monitor/?a=monitor-img-get&ds="+encodeURIComponent(o)+"&db="+encodeURIComponent(l)+"&period="+encodeURIComponent(n),"monitor-img-"+o);isFetchedDataValid(s)}async function monitor_logPage_ShowLog(e,t){const o="monitor",n=document.querySelector("#monitor-log-access"),i=document.querySelector("#monitor-log-error"),r=n&&n.checked?"access":i&&i.checked?"error":"web",c=document.querySelector("#monitor-log-200"),d=document.querySelector("#monitor-log-500"),m=document.querySelector("#monitor-log-1000");let l="50";c&&c.checked?l="200":d&&d.checked?l="500":m&&m.checked&&(l="1000");const s=e.target.id,a=new ButtonState(s);let g=await fetchText_Get("/monitor/?a=monitor-log-show&type="+r+"&rows="+l);if(a.restore(),!isFetchedDataValid(g))return;const h=document.getElementById(o+"-log-textarea");if(h){h.textContent=g;let e=0;for(let t=0;t<g.length;t++)"\n"==g[t]&&(e+=1);e+=1,h.rows=e.toString()}}async function monitor_eventPage_ShowLog(e,t){const o="monitor",n=document.querySelector("#monitor-event-200"),i=document.querySelector("#monitor-event-500"),r=document.querySelector("#monitor-event-1000");let c="50";n&&n.checked?c="200":i&&i.checked?c="500":r&&r.checked&&(c="1000");const d=e.target.id,m=new ButtonState(d);let l=await fetchText_Get("/monitor/?a=monitor-event-show&rows="+c);if(m.restore(),!isFetchedDataValid(l))return;const s=document.getElementById(o+"-event-textarea");if(s){s.textContent=l;let e=0;for(let t=0;t<l.length;t++)"\n"==l[t]&&(e+=1);e+=1,s.rows=e.toString()}}common_listeners();const monitor_sources=["la","mem","disk","net","nginx","mysql","exim"],monitor_periods=["day","week","month","year"];for(const e of monitor_sources)for(const t of monitor_periods)listener_AddSingleById("monitor-"+t+"-"+e,"change",null,null,monitor_periodChange_PngGet);const monitor_dbselectors=["net","mysql"];for(const e of monitor_dbselectors)listener_AddSingleById("monitor-sel-"+e,"change",null,null,monitor_dbSelectorChange_PngGet);listener_AddSingleById("monitor-log-show","click","keyup","Enter",monitor_logPage_ShowLog),listener_AddSingleById("monitor-event-show","click","keyup","Enter",monitor_eventPage_ShowLog),document.addEventListener("DOMContentLoaded",(function(){for(const e of monitor_sources){const t=document.getElementById("monitor-day-"+e);t&&t.dispatchEvent(new Event("change",{bubbles:!1}))}}));