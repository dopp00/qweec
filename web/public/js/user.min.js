"use strict";const G_L=new LangData("user-lang");async function User_Add_Confirm(e,s){const t="user-add-confirm";if(e.target.id!==t)return;const l=new PrepData(7);let r=!1;if(l.prepareValue(0,"#user-add-user",!0,G_L.raw("user")+" "+G_L.raw("is required"))||(r=!0),l.prepareValue(1,"#user-add-pass",!0,G_L.raw("password")+" "+G_L.raw("is required"))||(r=!0),l.prepareValue(2,"#user-add-contact",!0,G_L.raw("contact email")+" "+G_L.raw("is required"))||(r=!0),r)return;const a=new PrepData(1);if(a.prepareValue(0,"#user-add-pass-confirm",!0,G_L.raw("password")+" "+G_L.raw("is required"))||(r=!0),r)return;if(l.arr[1]!==a.arr[0])return void notificationNew_addError(G_L.raw("the entered password does not match"));l.prepareValue(3,"#user-add-fullname",!1,""),l.prepareValue(4,"#user-add-ntpl",!1,""),l.prepareValue(5,"#user-add-htpl",!1,""),l.prepareValue(6,"#user-add-btpl",!1,"");const i=new ButtonState(t),n=await fetchText_Post("/user/?a="+t,l.arr.join(" "));i.restore(),isFetchedOk(n,"/user/")}async function User_Edit_Confirm(e,s){const t="user-edit-confirm";if(e.target.id!==t)return;const l=new PrepData(16);let r=!1;if(l.prepareValue(0,"#user-edit-user",!0,G_L.raw("user")+" "+G_L.raw("is required"))||(r=!0),l.prepareValue(2,"#user-edit-contact",!0,G_L.raw("contact email")+" "+G_L.raw("is required"))||(r=!0),r)return;l.prepareValue(1,"#user-edit-pass",!1,""),l.prepareValue(3,"#user-edit-fullname",!1,""),l.prepareValue(4,"#user-edit-ntpl",!1,""),l.prepareValue(5,"#user-edit-htpl",!1,""),l.prepareValue(6,"#user-edit-btpl",!1,""),l.prepareValue(7,"#user-edit-limit-sites",!1,""),l.prepareValue(8,"#user-edit-limit-aliases",!1,""),l.prepareValue(9,"#user-edit-limit-mail-domains",!1,""),l.prepareValue(10,"#user-edit-limit-mail-accounts",!1,""),l.prepareValue(11,"#user-edit-limit-databases",!1,""),l.prepareValue(12,"#user-edit-limit-crons",!1,""),l.prepareValue(13,"#user-edit-limit-backups",!1,""),l.prepareValue(14,"#user-edit-limit-quota",!1,""),l.prepareValue(15,"#user-edit-limit-bandwidth",!1,"");const a=new PrepData(1);if(a.prepareValue(0,"#user-edit-pass-confirm",!1,""),l.arr[1]&&l.arr[1].length>0&&l.arr[1]!=a.arr[0])return void notificationNew_addError(G_L.raw("the entered password does not match"));const i=new ButtonState(t),n=await fetchText_Post("/user/?a="+t,l.arr.join(" "));if(i.restore(),isFetchedDataValid(n)&&"OK"===n){const e=document.getElementById("user-edit-user");if(e){const s=await fetchBlob_Post_UploadFile("/user/?a=user-edit-avatar","user-edit-avatar",{"avatar-user":e.value});if(!isFetchedDataValid(s))return}window.location="/user/"}}async function User_Import_OpenWnd(e,s){if(!params_Validate(s,"e",2))return;const t=s[0],l=s[1],r=['<div class="row jc-between h-2"><p class="modal-title">Import '+t+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>'],a=table_getSelectedIds(l);if(a.length<1)return void notificationNew_addError(t+" not selected");r.push('<p class="d-block m-t1">'+G_L.esc("Next items will be modified")+":</p>");const i=Array();for(let e=0;e<a.length;e+=1)i.push('"'+a[e].dataId+'"');r.push('<textarea class="w-100p h-5 m-t1" readonly>'+i.join(" ")+"</textarea>");const n=[];for(let e=0;e<a.length;e+=1)n.push(a[e].id);let c=n.join(",");c="'"+c.replaceAll("'","%QUO%")+"'",r.push('<form action="/user/?a=user-import" method="POST" enctype="multipart/form-data" class="grid-container user-import-grid-size m-t1">'),r.push('<p class="grid-cs1 pe-none">'+G_L.esc("options")+":</p>"),r.push('<p class="pe-none">'+G_L.esc("limits")+":</p>"),r.push('<label class="checkbox-simple-cntr grid-cs1"><input name="user-import-fname" type="checkbox" class="input-checkbox" value="yes">'+G_L.esc("full name")+"</label>"),r.push('<label class="checkbox-simple-cntr"><input name="user-import-limit-sites" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("sites")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs1"><input name="user-import-contact" type="checkbox" class="input-checkbox" value="yes">'+G_L.esc("contact email")+"</label>"),r.push('<label class="checkbox-simple-cntr"><input name="user-import-limit-aliases" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("web aliases")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs1"><input name="user-import-ntpl" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("nginx template")+"</label>"),r.push('<label class="checkbox-simple-cntr"><input name="user-import-limit-maildomains" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("mail domains")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs1"><input name="user-import-htpl" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("httpd template")+"</label>"),r.push('<label class="checkbox-simple-cntr"><input name="user-import-limit-mailaccounts" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("mail accounts")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs1"><input name="user-import-btpl" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("backend template")+"</label>"),r.push('<label class="checkbox-simple-cntr"><input name="user-import-limit-dbs" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("databases")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs2"><input name="user-import-limit-crons" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("cron jobs")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs2"><input name="user-import-limit-backups" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("backups")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs2"><input name="user-import-limit-quota" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("disk quota")+"</label>"),r.push('<label class="checkbox-simple-cntr grid-cs2"><input name="user-import-limit-bandwidth" type="checkbox" class="input-checkbox" value="yes" checked>'+G_L.esc("bandwidth")+"</label>"),r.push('<input id="user-import-file" type="file" name="user-import-file" class="h-2 grid-cs1" required>'),r.push('<input id="user-import-users" type="hidden" name="user-import-users" class="d-none" value="'+c+'" required>'),r.push('<button id="user-import-submit" class="btn grid-cs1" type="submit">'+G_L.esc("Import config")+"</button>"),r.push("</form>");const u=document.getElementById("modal-content");u&&(u.innerHTML=r.join("\n"));const o=document.getElementById("modal-popup");o&&(o.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close)}async function User_Export(e,s){if(!params_Validate(s,"e",3))return;if("modal-submit"!==e.target.id)return;const t=new ButtonState("modal-submit"),l=await fetchBlob_PostDownload(s[0],s[1]);t.restore(),isFetchedOk(l,s[2])}async function User_Export_OpenWnd(e,s){if(!params_Validate(s,"e",4))return;const t=s[0],l=s[1],r=s[2],a=s[3],i=['<div class="row jc-between h-2"><p class="modal-title">'+G_L.esc("Export")+" "+t+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>'],n=table_getSelectedIds(l);if(n.length<1)return void notificationNew_addError(t+" "+G_L.raw("not selected"));i.push('<p class="d-block m-t1">'+G_L.esc("Next items will be exported")+":</p>");const c=Array();for(let e=0;e<n.length;e+=1)c.push('"'+n[e].dataId+'"');i.push('<textarea class="w-100p h-5 m-t1" readonly>'+Html.escape(c.join(" "))+"</textarea>"),i.push('<a id="modal-submit" class="btn">'+G_L.esc("Download")+"</a>");const u=document.getElementById("modal-content");u&&(u.innerHTML=i.join("\n"));const o=document.getElementById("modal-popup");o&&(o.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close);const d=[];for(let e=0;e<n.length;e+=1)d.push(n[e].id);let p=d.join(",");p="'"+p.replaceAll("'","%QUO%")+"'",listener_AddSingleById("modal-submit","mouseup","keyup","Enter",User_Export,r,p,a)}common_listeners(),listener_AddSingleById("user-edit","click","keyup","Enter",table_OnButtonClick_Router,"tbl-user","/user/?a=user-edit&user=",""),listener_AddSingleById("user-login","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-user","/login/?a=relogin","/site/",""),listener_AddSingleById("user-import-wnd","click","keyup","Enter",User_Import_OpenWnd,G_L.esc("user profile"),"tbl-user"),listener_AddSingleById("user-export-wnd","click","keyup","Enter",User_Export_OpenWnd,G_L.esc("user profile"),"tbl-user","/user/?a=user-export","/user/"),listener_AddSingleById("user-on","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-user","/user/?a=user-on","/user/",""),listener_AddSingleById("user-off","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-user","/user/?a=user-off","/user/",""),listener_AddSingleById("user-delete-wnd","click","keyup","Enter",table_openDeleteWnd,"tbl-user","/user/?a=user-delete","/user/",G_L.esc("Delete users"),G_L.esc("Next items will be deleted"),G_L.esc("Confirm"),null),listener_AddSingleById("user-add-confirm","click","keyup","Enter",User_Add_Confirm),listener_AddSingleById("user-add-pass-gen","click",null,null,button_passwordGen,"user-add-pass","user-add-pass-confirm"),listener_AddSingleById("user-add-pass-vis","click",null,null,button_togglePasswordVisible,"user-add-pass","user-add-pass-confirm"),listener_AddSingleById("user-edit-pass-gen","click",null,null,button_passwordGen,"user-edit-pass","user-edit-pass-confirm"),listener_AddSingleById("user-edit-pass-vis","click",null,null,button_togglePasswordVisible,"user-edit-pass","user-edit-pass-confirm"),listener_AddSingleById("user-edit-confirm","click","keyup","Enter",User_Edit_Confirm),listeners_Add("table.tbl-fixed tbody","tr","mouseup",null,null,table_OnClickRouter,"/user/?a=user-edit&user="),listener_AddSingleById("user-name-sort","click",null,null,table_Sort,"/user/","user-table-sort","sort-name-az,sort-name-za"),listener_AddSingleById("users-checkbox-header","mouseup",null,null,table_SetAllCheckboxes,"table#tbl-user tbody tr td .checkbox-simple-cntr input[type=checkbox]"),listeners_Add(null,".pageidx","click",null,null,table_SelectPage,"user-table-page","/user/"),listener_AddSingleById("user-table-setting","click","keyup","Enter",tableSetting_Modal_OpenWnd,JSON.stringify({id:"user-table-setting",cookie:"user-table-setting",path:"/user/",titles:[G_L.esc("Settings"),G_L.esc("Number of rows"),G_L.esc("custom"),G_L.esc("Confirm")],values:[1,2,4,8,16,32],names:["user","fullname","contact","sites","databases","mail"],labels:[G_L.esc("user"),G_L.esc("full name"),G_L.esc("contact email"),G_L.esc("sites"),G_L.esc("databases"),G_L.esc("mail")]}));