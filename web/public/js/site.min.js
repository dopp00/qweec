"use strict";const G_L=new LangData("site-lang");async function site_certTypeSelector(e,t){if(!params_Validate(t,"e",1))return;const i=t[0],l=document.querySelector("label[for=site-"+i+"-ssl-privkey]"),s=document.getElementById("site-"+i+"-ssl-privkey"),n=document.querySelector("label[for=site-"+i+"-ssl-fullchain]"),r=document.getElementById("site-"+i+"-ssl-fullchain");if(!(l&&s&&n&&r))return;const d=document.getElementById("site-"+i+"-ssl-custom"),a=d&&d.checked;enableClass_DBlock(l,a),enableClass_DBlock(s,a),enableClass_DBlock(n,a),enableClass_DBlock(r,a)}async function site_Add_OnDomainFocusOut(e,t){const i=document.querySelector("#site-add-domain"),l=i?i.value:"";if(l.length<1)return;const s=document.querySelector("#site-add-alias");s&&s.value.length<1&&(s.value="www."+l);const n=document.querySelector("#site-add-rootdir");if(n&&n.value<1){var r=await fetchText_Get("/site/?a=site-punycode&data="+encodeURIComponent(l));if(!isFetchedDataValid(r))return;n.value="/"+Html.parse(r),input_PrefixPath_Set("site-add-rootdir","site-add-webdir","site-add-rootdir-eff")}}function site_FindTpl(e,t){const i=document.querySelector(e);if(i)for(const e of i.options)if(e.value==t)return!0;return!1}function site_FindAllTpl(e,t,i,l){let s="",n="",r="";const d=["7.2","7.3","7.4","8.0","8.1","8.2","8.3","8.4"];for(const t of d){switch(e){case"nginx-httpd-php-fpm-alt"+t:s="proxy",n="php-fpm",r="php-fpm-alt"+t;break;case"nginx-cache-httpd-php-fpm-alt"+t:s="proxy-cache",n="php-fpm",r="php-fpm-alt"+t;break;case"nginx-php-fpm-alt"+t:s="php-fpm",r="php-fpm-alt"+t;break;case"nginx-cache-php-fpm-alt"+t:s="php-fpm-cache",r="php-fpm-alt"+t;break;case"httpd-php-fpm-alt-"+t:n="php-fpm",r="php-fpm-alt-"+t;break}if(""!==s||""!==n||""!==r)break}if(""===s&&""===n&&""===r)switch(e){case"nginx-httpd-php-fpm":s="proxy",n="php-fpm",r="php-fpm";break;case"nginx-cache-httpd-php-fpm":s="proxy-cache",n="php-fpm",r="php-fpm";break;case"nginx-php-fpm":s="php-fpm",r="php-fpm";break;case"nginx-cache-php-fpm":s="php-fpm-cache",r="php-fpm";break;case"nginx-html":s="html";break;case"httpd-php-fpm":n="php-fpm",r="php-fpm";break;case"httpd-html":n="html";break;case"custom":break;default:return{aggrtpl:"custom",ntpl:"",htpl:"",btpl:"",err:"aggregated template is invalid"}}return""==s||site_FindTpl(t,s)?""==n||site_FindTpl(i,n)?""==r||site_FindTpl(l,r)?{aggrtpl:e,ntpl:s,htpl:n,btpl:r,err:""}:{aggrtpl:"custom",ntpl:"",htpl:"",btpl:"",err:"btpl not found"}:{aggrtpl:"custom",ntpl:"",htpl:"",btpl:"",err:"htpl not found"}:{aggrtpl:"custom",ntpl:"",htpl:"",btpl:"",err:"ntpl not found"}}async function site_OnAggregatedTplChange(e,t){if(!params_Validate(t,"e",1))return;const i=t[0],l=document.querySelector("#site-"+i+"-aggrtpl");if(!l)return;const s=document.querySelector("#site-"+i+"-ntpl"),n=document.querySelector("#site-"+i+"-htpl"),r=document.querySelector("#site-"+i+"-btpl"),d=site_FindAllTpl(l.value,"#site-"+i+"-ntpl","#site-"+i+"-htpl","#site-"+i+"-btpl");"string"==typeof d.err&&notificationNew_addError(d.err),"string"==typeof d.aggrtpl&&""!=d.aggrtpl&&(l.value=d.aggrtpl),"string"==typeof d.ntpl&&""!=d.ntpl&&s&&(s.value=d.ntpl),"string"==typeof d.htpl&&""!=d.htpl&&n&&(n.value=d.htpl),"string"==typeof d.btpl&&""!=d.btpl&&r&&(r.value=d.btpl),"custom"===d.aggrtpl?(s&&s.removeAttribute("disabled"),n&&n.removeAttribute("disabled"),r&&r.removeAttribute("disabled")):(s.setAttribute("disabled","disabled"),n.setAttribute("disabled","disabled"),r.setAttribute("disabled","disabled"))}async function site_Add_Confirm(e,t){const i=new PrepData(13);let l=!1;if(i.prepareValue(0,"#site-add-domain",!0,G_L.raw("domain")+" "+G_L.raw("is required"))||(l=!0),i.prepareValue(2,"#site-add-rootdir",!0,G_L.raw("site directory")+" "+G_L.raw("is required"))||(l=!0),l)return;if(!(i.prepareValue(1,"#site-add-alias",!1,"")&&i.prepareValue(3,"#site-add-ip4",!1,"")&&i.prepareValue(4,"#site-add-ip6",!1,"")&&i.prepareRadio(5,["#site-add-ssl-none","#site-add-ssl-ss","#site-add-ssl-le","#site-add-ssl-custom"])&&i.prepareValue(8,"#site-add-btpl",!1,"")&&i.prepareValue(9,"#site-add-next",!1,"")&&i.prepareChecked(10,"#site-add-http2")))return;i.prepareValue(6,"#site-add-ntpl",!1,""),i.prepareValue(7,"#site-add-htpl",!1,""),i.prepareValue(11,"#site-add-ssl-privkey",!1,""),i.prepareValue(12,"#site-add-ssl-fullchain",!1,"");const s="site-add-confirm",n=new ButtonState(s),r=await fetchText_Post("/site/?a="+s,i.arr.join(" "));n.restore(),isFetchedOk(r,"/site/")}async function site_Edit_Confirm(e,t){const i=new PrepData(13);let l=!1;if(i.prepareValue(0,"#site-edit-domain",!0,G_L.raw("domain")+" "+G_L.raw("is required"))||(l=!0),i.prepareValue(2,"#site-edit-rootdir",!0,G_L.raw("site directory")+" "+G_L.raw("is required"))||(l=!0),l)return;if(!(i.prepareValue(1,"#site-edit-alias",!1,"")&&i.prepareValue(3,"#site-edit-ip4",!1,"")&&i.prepareValue(4,"#site-edit-ip6",!1,"")&&i.prepareRadio(5,["#site-edit-ssl-none","#site-edit-ssl-ss","#site-edit-ssl-le","#site-edit-ssl-custom"])&&i.prepareValue(8,"#site-edit-btpl",!1,"")&&i.prepareValue(9,"#site-edit-next",!1,"")&&i.prepareChecked(10,"#site-edit-http2")))return;i.prepareValue(6,"#site-edit-ntpl",!1,""),i.prepareValue(7,"#site-edit-htpl",!1,""),i.prepareValue(11,"#site-edit-ssl-privkey",!1,""),i.prepareValue(12,"#site-edit-ssl-fullchain",!1,"");const s="site-edit-confirm",n=new ButtonState(s),r=await fetchText_Post("/site/?a="+s,i.arr.join(" "));n.restore(),isFetchedOk(r,"/site/")}async function site_Dns_table_storeDomains_getSiteId(e,t){const i=document.querySelectorAll("table#tbl-site tbody tr"),l=[];for(let e=0;e<i.length;e+=1)i[e].querySelector(".checkbox-simple-cntr input[type=checkbox]").checked&&i[e].id.length&&l.push(i[e].id);if(l.length<1)return void notificationNew_addError("no sites selected");let s=new PrepData(1);if(s.prepareString(0,l.join(",")),""===s.arr[0]);else{const e=await fetchText_Post("/dns/?a=dns-site-store-id",s.arr.join(","));isFetchedOkWithLink2("/dns/?a=dns-site&prov=&ipv=&dns=",e,!0)}}common_listeners(),listener_AddSingleById("site-edit","click","keyup","Enter",table_OnButtonClick_Router,"tbl-site","/site/?a=site-edit&site=",""),listener_AddSingleById("site-log","click","keyup","Enter",table_OnButtonClick_Router,"tbl-site","/site/?a=site-log&site=",""),listener_AddSingleById("site-stat","click","keyup","Enter",table_OnButtonClick_Router,"tbl-site","/site/?a=site-stat&site=","_blank"),listener_AddSingleById("site-dns","click","keyup","Enter",site_Dns_table_storeDomains_getSiteId),listener_AddSingleById("site-on","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-site","/site/?a=site-on","/site/",""),listener_AddSingleById("site-off","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-site","/site/?a=site-off","/site/",""),listener_AddSingleById("site-delete-wnd","click","keyup","Enter",table_openDeleteWnd,"tbl-site","/site/?a=site-delete","/site/",G_L.esc("Delete")+" "+G_L.esc("sites"),G_L.esc("Next items will be deleted"),G_L.esc("Confirm"),'<label class="checkbox-simple-cntr m-b1 m-t1"><input id="modal-site-delete-dir" type="checkbox" class="input-checkbox" value="yes">'+G_L.esc("delete site directories")+"</label>\n"),listener_AddSingleById("site-add-rootdir","input",null,null,input_PrefixPath_OnInput,"site-add-webdir","site-add-rootdir-eff"),listener_AddSingleById("site-add-domain","focusout",null,null,site_Add_OnDomainFocusOut),listener_AddSingleById("site-add-aggrtpl","change",null,null,site_OnAggregatedTplChange,"add"),listener_AddSingleById("site-add-ssl-none","change",null,null,site_certTypeSelector,"add"),listener_AddSingleById("site-add-ssl-ss","change",null,null,site_certTypeSelector,"add"),listener_AddSingleById("site-add-ssl-le","change",null,null,site_certTypeSelector,"add"),listener_AddSingleById("site-add-ssl-custom","change",null,null,site_certTypeSelector,"add"),listener_AddSingleById("site-add-confirm","click","keyup","Enter",site_Add_Confirm),listener_AddSingleById("site-edit-rootdir","input",null,null,input_PrefixPath_OnInput,"site-edit-webdir","site-edit-rootdir-eff"),listener_AddSingleById("site-edit-aggrtpl","change",null,null,site_OnAggregatedTplChange,"edit"),listener_AddSingleById("site-edit-ssl-none","change",null,null,site_certTypeSelector,"edit"),listener_AddSingleById("site-edit-ssl-ss","change",null,null,site_certTypeSelector,"edit"),listener_AddSingleById("site-edit-ssl-le","change",null,null,site_certTypeSelector,"edit"),listener_AddSingleById("site-edit-ssl-custom","change",null,null,site_certTypeSelector,"edit"),listener_AddSingleById("site-edit-confirm","click","keyup","Enter",site_Edit_Confirm),listener_AddSingleById("site-log-show","click","keyup","Enter",logPage_ShowLog,"#site-log-domain","site"),listeners_Add("table.tbl-fixed tbody","tr","mouseup",null,null,table_OnClickRouter,"/site/?a=site-edit&site="),listener_AddSingleById("site-name-sort","click",null,null,table_Sort,"/site/","site-table-sort","sort-no,sort-name-az,sort-name-za"),listener_AddSingleById("sites-checkbox-header","mouseup",null,null,table_SetAllCheckboxes,"table#tbl-site tbody tr td .checkbox-simple-cntr input[type=checkbox]"),listeners_Add(null,".pageidx","click",null,null,table_SelectPage,"site-table-page","/site/"),listener_AddSingleById("site-table-setting","click","keyup","Enter",tableSetting_Modal_OpenWnd,JSON.stringify({id:"site-table-setting",cookie:"site-table-setting",path:"/site/",titles:[G_L.esc("Settings"),G_L.esc("Number of rows"),G_L.esc("custom"),G_L.esc("Confirm")],values:[1,2,8,16,32],names:["website","ssl","templates","ipaddresses","rootdir"],labels:[G_L.esc("website"),"ssl",G_L.esc("templates"),G_L.esc("ip addresses"),G_L.esc("root dir")]}));