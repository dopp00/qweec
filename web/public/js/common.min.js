"use strict";const qweecGlobals={clickCount:0,clickTimer:null};function isFetchedDataValid(e){return e&&"string"==typeof e?!e.startsWith("<!DOCTYPE")||(window.location="/login/",!1):(console.log("data object is undefined"),!1)}function followPage(e,t){if(e&&"string"==typeof e&&e.length>0){const n="self"===e?window.location.href:e;t&&t.length>0?window.open(n,t):window.location=n}}function isFetchedOk(e,t,n){return!!isFetchedDataValid(e)&&("OK"===e&&followPage(t,n),!0)}function isFetchedOkWithLink(e,t,n){if(!isFetchedDataValid(e))return!1;if(e.startsWith("OK")){const o=e.substring(2);followPage(o.length>0?o:t,n)}else notificationNew_addError(e);return!0}function isFetchedOkWithLink2(e,t,n){if(!isFetchedDataValid(t))return!1;if(t.startsWith("OK")){const o=n?encodeURIComponent(t.substring(2)):t.substring(2);window.location=e+o}return!0}function params_Validate(e,t,n){if(!e||("e"===t?e.length!=n:e.length<n))return!1;for(let t=0;t<n;t+=1)if(!e[t]||e[t].length<1)return!1;return!0}const Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(let n=0;n<e.length;n++){const o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",n=0,o=0,l=0,i=0;n<e.length;)(o=e.charCodeAt(n))<128?(t+=String.fromCharCode(o),n+=1):o>191&&o<224?(l=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&l),n+=2):(l=e.charCodeAt(n+1),i=e.charCodeAt(n+2),t+=String.fromCharCode((15&o)<<12|(63&l)<<6|63&i),n+=3);return t},encode:function(e){var t,n,o,l,i,a,c,s="",r=0;for(e=Base64._utf8_encode(e);r<e.length;)l=(t=e.charCodeAt(r++))>>2,i=(3&t)<<4|(n=e.charCodeAt(r++))>>4,a=(15&n)<<2|(o=e.charCodeAt(r++))>>6,c=63&o,isNaN(n)?a=c=64:isNaN(o)&&(c=64),s=s+this._keyStr.charAt(l)+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(c);return s},decode:function(e){var t,n,o,l,i,a,c="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)t=this._keyStr.indexOf(e.charAt(s++))<<2|(l=this._keyStr.indexOf(e.charAt(s++)))>>4,n=(15&l)<<4|(i=this._keyStr.indexOf(e.charAt(s++)))>>2,o=(3&i)<<6|(a=this._keyStr.indexOf(e.charAt(s++))),c+=String.fromCharCode(t),64!=i&&(c+=String.fromCharCode(n)),64!=a&&(c+=String.fromCharCode(o));return c=Base64._utf8_decode(c)}},Password={_getRandomByte:function(){if(window.crypto&&window.crypto.getRandomValues){var e=new Uint8Array(1);return window.crypto.getRandomValues(e),e[0]}if(window.msCrypto&&window.msCrypto.getRandomValues){e=new Uint8Array(1);return window.msCrypto.getRandomValues(e),e[0]}return Math.floor(256*Math.random())},generate:function(e,t){return(!t||t.length<1)&&(t=/[a-zA-Z0-9_\-\+\.]/),Array.apply(null,{length:e}).map((function(){for(var e;;)if(e=String.fromCharCode(this._getRandomByte()),t.test(e))return e}),this).join("")}};function button_passwordGen(e,t){if(!params_Validate(t,"ge",1))return;const n=document.getElementById(t[0]);if(n&&(n.value=Password.generate(16),t.length>=2&&t[1]&&t[1].length>1)){const e=document.getElementById(t[1]);if(!e)return;e.value=n.value}}function button_togglePasswordVisible(e,t){if(!params_Validate(t,"ge",1))return;const n=document.getElementById(t[0]);if(n&&(n.type="password"==n.type?"text":"password",t.length>=2&&t[1]&&t[1].length>1)){const e=document.getElementById(t[1]);if(!e)return;e.type=n.type}}const Str={trimLeft:function(e,t){if(!e||e.length<1)return"";if(!t||t.length<1)return e;let n=0;for(let o=0;o<e.length;o+=1){for(let l=0;l<t.length;l+=1)if(e[o]===t[l]){n=o+1;break}if(n!=o+1)break}return 0==n?e:e.substring(n)}};function isNumber(e){return null!=e&&!isNaN(e)&&"number"==typeof e&&isFinite(e)}const Html={escape:function(e){return e&&"string"==typeof e?e.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("&","&amp;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):""},parse:function(e){return e&&"string"==typeof e?e.replaceAll("&lt;","<").replaceAll("&#60;","<").replaceAll("&gt;",">").replaceAll("&#62;",">").replaceAll("&amp;","&").replaceAll("&#38;","&").replaceAll("&quot;",'"').replaceAll("&#34;",'"').replaceAll("&apos;","'").replaceAll("&#39;","'"):""}},Cookie={get:function(e,t=!1){const n=e+"=";let o=document.cookie.split(";");for(let e=0;e<o.length;e+=1){let l=Str.trimLeft(o[e]," ");if(0==l.indexOf(n))return t?Base64.decode(l.substring(n.length,l.length)):l.substring(n.length,l.length)}return null},delete:function(e,t){document.cookie=e+"=; Path="+t+"; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},setHttps:function(e,t,n,o,l=!1){let i="";if(n){let e=new Date;e.setTime(e.getTime()+6e4*n),i="; expires="+e.toUTCString()}(!o||o.length<1)&&(o="/"),l&&(t=Base64.encode(t)),document.cookie=e+"="+(t||"")+i+"; path="+o+"; Secure;"},set_redirectToPage:async function(e,t){if(!params_Validate(t,"e",2))return;if(e.target.id!=t[0])return;const n=document.getElementById(t[0]);n&&(Cookie.setHttps(t[0],n.value,43200,t[1],!1),window.location=t[1])}};function getOS(){const e=window.navigator.userAgent,t=window.navigator&&window.navigator.userAgentData?window.navigator.userAgentData.platform:window.navigator.platform;let n="";return-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?n="windows":-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?n="macos":/Linux/.test(t)?n="linux":-1!==["iPhone","iPad","iPod"].indexOf(t)?n="ios":/Android/.test(e)&&(n="android"),n}function enableClass_DBlock(e,t){if(!e)return;e.classList.remove(t?"d-none":"d-block");const n=t?"d-block":"d-none";e.classList.contains(n)||e.classList.add(n)}function enableClass_DInblock(e,t){if(!e)return;e.classList.remove(t?"d-none":"d-inblock");const n=t?"d-inblock":"d-none";e.classList.contains(n)||e.classList.add(n)}class ButtonState{constructor(e){if(this.btn=document.getElementById(e),this.btn){for(let e of this.btn.childNodes)if(3===e.nodeType){this.originalText=e.textContent,e.textContent="wait..";break}this.btn.setAttribute("disabled","")}}restore(){if(this.btn&&(this.btn.removeAttribute("disabled"),this.originalText))for(let e of this.btn.childNodes)if(3===e.nodeType){e.textContent=this.originalText;break}}}class IconButtonState{constructor(e){if(this.btn=document.getElementById(e),this.btn){this.btn.setAttribute("disabled","");const e="d-none";for(const t of this.btn.children)t&&t.hasAttribute("src")&&(t.src.endsWith("/img/loading.svg")?t.classList.remove(e):t.classList.contains(e)||t.classList.add(e))}}restore(){if(this.btn){this.btn.removeAttribute("disabled");const e="d-none";for(const t of this.btn.children)t&&t.hasAttribute("src")&&(t.src.endsWith("/img/loading.svg")?t.classList.contains(e)||t.classList.add(e):t.classList.remove(e))}}}class PrepData{arr;constructor(e){this.arr=Array.from({length:e}).map((e=>"''"))}prepareString(e,t){return!!t&&(t.length>=2&&"'"==t[0]&&"'"==t[t.length-1]&&(t=t.substring(1,t.length-1)),this.arr[e]="'"+t.replaceAll("'","%QUO%")+"'",!0)}prepareValue(e,t,n,o){const l=document.querySelector(t);if(l&&null!==l.value&&void 0!==l.value){let t=l.value;return t.length>=2&&"'"==t[0]&&"'"==t[t.length-1]&&(t=t.substring(1,t.length-1)),""===t&&n?(l.classList.contains("invalid-value")||l.classList.add("invalid-value"),notificationNew_addError(o),!1):(l.classList.remove("invalid-value"),this.arr[e]="'"+t.replaceAll("'","%QUO%")+"'",!0)}return console.log(t+" value invalid"),!1}prepareChecked(e,t){const n=document.querySelector(t);return n?(this.arr[e]=n.checked?"'yes'":"''",!0):(console.log(t+" value invalid"),!1)}agregateChecked(e,t,n){if(!t||!n||t.length!=n.length)return console.log("agregateChecked: invalid data passed "),!1;let o=0;for(let e=0;e<t.length;e+=1){const l=document.querySelector(t[e]);l&&l.checked&&(o|=n[e])}return this.arr[e]="'"+o.toString(10)+"'",!0}prepareRadio(e,t){this.arr[e]="''";for(let n=0;n<t.length;n+=1){const o=document.querySelector(t[n]);if(o&&o.checked)return this.arr[e]="'"+o.value+"'",!0}return console.log("radio box value invalid"),!1}}function escapeBodyParam(e){return"'"+e.replaceAll("'","%QUO%")+"'"}async function fetchText_Get(e){let t=await fetch(window.location.protocol+"//"+window.location.host+e,{method:"GET",mode:"same-origin",cache:"no-cache",headers:{Accept:"text/plain","Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, HEAD"}}).catch((e=>console.log(e)));if(200===t.status)return t.text();notificationNew_addError(await t.text());return null}async function fetchText_Post(e,t){let n=await fetch(window.location.protocol+"//"+window.location.host+e,{method:"POST",mode:"same-origin",cache:"no-cache",headers:{"Content-Type":"text/plain",Accept:"text/plain","Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, POST, HEAD"},body:t}).catch((e=>console.log(e)));if(200===n.status)return n.text();notificationNew_addError(await n.text());return null}async function fetchBlob_PostDownload(e,t){let n=await fetch(window.location.protocol+"//"+window.location.host+e,{method:"POST",mode:"same-origin",cache:"no-cache",headers:{"Content-Type":"text/plain",Accept:"application/octet-stream","Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, POST, HEAD"},body:t}).catch((e=>console.log(e)));if(200===n.status){const e=n.headers.get("Content-Disposition"),t=n.headers.get("Content-Type");let o=e.split(/;(.+)/)[1].split(/=(.+)/)[1];if(o=o.toLowerCase().startsWith("utf-8''")?decodeURIComponent(o.replace(/utf-8''/i,"")):o.replace(/['"]/g,""),"application/octet-stream"===t.toLowerCase()&&o&&o.length>1){const e=await n.blob();if(e){let t=window.URL.createObjectURL(e),n=document.createElement("a");return n.href=t,n.download=o,document.body.appendChild(n),n.click(),n.remove(),"OK"}}}return notificationNew_addError("failed to download file"),null}async function fetchBlob_Post_UploadFile(e,t,n){const o=document.getElementById(t);if(!o||o.files.length<1)return"OK";const l=new FormData;if(l.append(t,o.files[0]),n)for(const e in n)n.hasOwnProperty(e)&&(console.log(`${e}: ${n[e]}`),l.append(e,n[e]));return 200===(await fetch(window.location.protocol+"//"+window.location.host+e,{method:"POST",mode:"same-origin",cache:"no-cache",headers:{Accept:"text/plain","Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, POST, HEAD"},body:l}).catch((e=>console.log(e)))).status?"OK":null}async function fetchText_Delete(e,t){let n=await fetch(window.location.protocol+"//"+window.location.host+e,{method:"DELETE",mode:"same-origin",cache:"no-cache",headers:{"Content-Type":"text/plain",Accept:"text/plain","Access-Control-Allow-Origin":window.location.protocol+"//"+window.location.host,"Access-Control-Allow-Methods":"GET, POST, HEAD"},body:t}).catch((e=>console.log(e)));if(200===n.status)return n.text();notificationNew_addError(await n.text());return null}function listener_AddSingleById(e,t,n,o,l,...i){const a=document.getElementById(e);a&&(t&&t.length>0&&a.addEventListener(t,(function(t){t.preventDefault(),t.stopPropagation(),t.target.id===e&&l(t,i)})),n&&n.length>0&&(o&&o.length>0?a.addEventListener(n,(function(t){if(t.key===o){if(t.preventDefault(),t.stopPropagation(),t.target.id!==e)return;l(t,i)}})):a.addEventListener(n,(function(t){t.preventDefault(),t.stopPropagation(),t.target.id===e&&l(t,i)}))))}function listeners_Add(e,t,n,o,l,i,...a){let c;if(e){const n=document.querySelector(e);n&&(c=n.querySelectorAll(t))}else c=document.querySelectorAll(t);if(c){if(n&&n.length>0)for(let e=0;e<c.length;e++)c[e]&&c[e].addEventListener(n,(function(e){e.preventDefault(),e.stopPropagation(),i(e,a)}));if(o&&o.length>0)for(let e=0;e<c.length;e++)c[e]&&(l&&l.length>0?c[e].addEventListener(o,(function(e){e.key===l&&(e.preventDefault(),e.stopPropagation(),i(e,a))})):c[e].addEventListener(o,(function(e){e.preventDefault(),e.stopPropagation(),i(e,a)})))}}function getAllElementChildsByTag(e,t){const n=[];let o=e.firstChild;t&&(t=t.toLowerCase());do{(o.nodeName.toLowerCase()===t||!t&&o.nodeType===Node.ELEMENT_NODE)&&n.push(o)}while(o=o.nextSibling);return n}function table_SetAllCheckboxes(e,t){if("input"===e.target.nodeName.toLowerCase()&&"checkbox"===e.target.type){const n=!e.target.checked;if(t&&1==t.length&&t[0]){const e=t[0],o=document.querySelectorAll(e);for(let e=0;e<o.length;e++)o[e].checked=n}}}function table_SelectRow(e,t){if("td"==e.firstElementChild.nodeName.toLowerCase()){const n=e.firstElementChild.getElementsByTagName("input")[0];"checkbox"===n.type&&(t?(n.checked=!0,e.classList.add("selected")):(n.checked=!1,e.classList.remove("selected")))}}function table_SetLastTouchedRow(e,t){if("td"==e.firstElementChild.nodeName.toLowerCase()){const n=e.firstElementChild.getElementsByTagName("input");n&&n[0]&&"checkbox"===n[0].type&&(t?e.classList.add("last-touched"):e.classList.remove("last-touched"))}}function table_GetAndClearLastTouched(e){let t=-1;for(let n=0;n<e.length;n++)e[n].classList.contains("last-touched")&&(e[n].classList.remove("last-touched"),t=n);return t}function table_GetRowIdx(e,t){let n=-1;for(let o=0;o<e.length;o++)e[o]==t&&(n=o);return n}function table_SelectRows(e){const t=e.target.parentNode;if("tr"!=t.nodeName.toLowerCase())return;const n=t.classList.contains("selected"),o=getAllElementChildsByTag(t.parentNode,"tr");if(e.shiftKey){const e=table_GetAndClearLastTouched(o),n=table_GetRowIdx(o,t);if(e>=0&&n>=0){document.getSelection().removeAllRanges(),table_SetLastTouchedRow(o[n],!0);var l=e,i=n;if(i<l){var a=i;i=l,l=a}for(let e=l;e<=i;e++)table_SelectRow(o[e],!0)}}else if(e.ctrlKey||e.metaKey&&"macos"==getOS()){const e=table_GetRowIdx(o,t);if(e>=0){document.getSelection().removeAllRanges();for(let e=0;e<o.length;e++)table_SetLastTouchedRow(o[e],!1);table_SetLastTouchedRow(o[e],!0),table_SelectRow(o[e],!n)}}else{for(let e=0;e<o.length;e++)table_SetLastTouchedRow(o[e],!1),table_SelectRow(o[e],!1);table_SetLastTouchedRow(t,!0),n||table_SelectRow(t,!0)}}function table_OnClickRouter(e,t){if(qweecGlobals.clickCount+=1,1===qweecGlobals.clickCount)qweecGlobals.clickTimer=setTimeout((function(){qweecGlobals.clickCount=0}),250),table_SelectRows(e);else if(2===qweecGlobals.clickCount){clearTimeout(qweecGlobals.clickTimer),qweecGlobals.clickCount=0;const n=e.target.parentNode;if("tr"!=n.nodeName.toLowerCase())return;if(!t||1!==t.length||!t[0]||t[0].length<0||n.id.length<0)return;window.location=t[0]+encodeURIComponent(n.id)}}function table_OnButtonClick_Router(e,t){if(!params_Validate(t,"ge",2))return void notificationNew_addError("invalid params specified");const n=document.querySelectorAll("table#"+t[0]+" tbody tr");let o=null;for(let e=0;e<n.length;e+=1)if(n[e].querySelector(".checkbox-simple-cntr input[type=checkbox]").checked&&n[e].id.length){if(o)return void notificationNew_addError("select only one row for this action");o=n[e].id}o?t.length>=3&&t[2]&&t[2].length>0?window.open(window.location.protocol+"//"+window.location.host+t[1]+encodeURIComponent(o),t[2]):window.location=window.location.protocol+"//"+window.location.host+t[1]+encodeURIComponent(o):notificationNew_addError("row not selected")}async function table_RunPostOnButtonClick_MultiRouter(e,t){if(!params_Validate(t,"ge",3))return void notificationNew_addError("invalid params specified");const n=[],o=document.querySelectorAll("table#"+t[0]+" tbody tr");for(let e=0;e<o.length;e+=1)o[e].querySelector(".checkbox-simple-cntr input[type=checkbox]").checked&&n.push(o[e].id);if(n.length<1)return void notificationNew_addError("no rows selected");const l=e.target.id,i=new ButtonState(l),a=await fetchText_Post(t[1],n.join(","));i.restore(),isFetchedOk(a,t[2],t[3])}function table_Sort(e,t){if(!params_Validate(t,"e",3))return;const n=t[2].split(",");let o=n[0];for(let t=0;t<n.length;t+=1)if(e.target.alt===n[t]&&t+1<n.length){o=n[t+1];break}Cookie.setHttps(t[1],o,2592e3,t[0]),window.location=t[0]}function tableSetting_ActivateSizeInput(e,t){if(e.target.checked){const t=document.getElementById("tblsz-custom-text");"tblsz-20"==e.target.id||"tblsz-50"==e.target.id||"tblsz-100"==e.target.id?t.setAttribute("disabled","disabled"):"tblsz-custom"==e.target.id&&t.removeAttribute("disabled")}}function tableSetting_Set(e,t){if(!params_Validate(t,"e",1))return;const n=JSON.parse(t[0]);let o=0;if("modal-submit"==e.target.id){const t=document.querySelector("#modal-content");if(t){let e=null;if(n.names.length==n.values.length&&n.names.length==n.labels.length)for(let l=0;l<n.names.length;l+=1)""!=n.names[l]&&(e=t.querySelector("#modal-filter-"+n.names[l]),e&&e.checked&&(o|=n.values[l]));const l=t.querySelector("#tblsz-20"),i=t.querySelector("#tblsz-50"),a=t.querySelector("#tblsz-100"),c=t.querySelector("#tblsz-custom");if(l&&l.checked)o|=20480;else if(i&&i.checked)o|=51200;else if(a&&a.checked)o|=102400;else if(c&&c.checked){const e=t.querySelector("#tblsz-custom-text");if(e){let t=parseInt(e.value,10);isNumber(t)?(t<1?t=50:t>1e4&&(t=1e4),o|=t<<10):o|=51200}}else o|=51200}return Cookie.setHttps(n.cookie,o.toString(10),43200,n.path),modal_Close(e,null),void(window.location=n.path)}}function tableSetting_Modal_OpenWnd(e,t){if(!params_Validate(t,"e",1))return;const n=JSON.parse(t[0]),o=['<div class="row jc-between h-2"><p class="modal-title">'+n.titles[0]+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr class="m-b1">\n'];let l=1023;const i=Cookie.get(n.cookie);if(null==i?l=1023:(l=parseInt(i,10),isNumber(l)||(l=1023)),n.names.length==n.values.length&&n.names.length==n.labels.length)for(let e=0;e<n.names.length;e+=1)if(""!=n.names[e]){let t=(l&n.values[e])==n.values[e]?" checked":"";o.push('<label class="checkbox-simple-cntr m-b1"><input id="modal-filter-'+n.names[e]+'" type="checkbox" class="input-checkbox" '+t+">"+n.labels[e]+"</label>")}let a="",c="",s="",r="",d=" disabled",u="";const f=l>>10;20==f?a=" checked":50==f?c=" checked":100==f?s=" checked":(r=" checked",d="",u=f.toString()),o.push('<p class="m-b1 c-99">'+n.titles[1]+":</p>"),o.push('<fieldset class="radio-row">'),o.push('<div class="radio-item"><input id="tblsz-20" type="radio" name="radio" value="20"'+a+'><label for="tblsz-20" role="radio">20</label></div>'),o.push('<div class="radio-item"><input id="tblsz-50" type="radio" name="radio" value="50"'+c+'><label for="tblsz-50" role="radio">50</label></div>'),o.push('<div class="radio-item"><input id="tblsz-100" type="radio" name="radio" value="100"'+s+'><label for="tblsz-100" role="radio">100</label></div>'),o.push('<div class="radio-item"><input id="tblsz-custom" type="radio" name="radio" value=""'+r+'><label for="tblsz-custom" role="radio">'+n.titles[2]+':</label><input id="tblsz-custom-text" type="text" name="custom" value="'+u+'" '+d+"></div>"),o.push("</fieldset>"),o.push('<a id="modal-submit" class="btn">'+n.titles[3]+"</a>");const g=document.getElementById("modal-popup"),h=document.getElementById("modal-content");g&&h&&(h.innerHTML=o.join("\n"),g.style.display="block",modal_Open(null,null),listener_AddSingleById("tblsz-20","change",null,null,tableSetting_ActivateSizeInput,null),listener_AddSingleById("tblsz-50","change",null,null,tableSetting_ActivateSizeInput,null),listener_AddSingleById("tblsz-100","change",null,null,tableSetting_ActivateSizeInput,null),listener_AddSingleById("tblsz-custom","change",null,null,tableSetting_ActivateSizeInput,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close),listener_AddSingleById("modal-submit","mouseup","keyup","Enter",tableSetting_Set,t[0]))}function table_SelectPage(e,t){if(!params_Validate(t,"e",2))return;const n=new URL(e.target.href);let o=parseInt(n.hash.replace(/^#/,""),10);isNumber(o)||(o=1),Cookie.setHttps(t[0],o.toString(10),43200,t[1]),window.location=t[1]}function input_SearchFilter(e,t){if(!params_Validate(t,"e",1))return;const n=e.target.value.toLowerCase();let o=t[0];const l=getAllElementChildsByTag(e.target.parentNode,o);for(let e=0;e<l.length;e++)if(l[e].classList.contains("link-cat")){(l[e].textContent||l[e].innerText).toLowerCase().indexOf(n)>-1?l[e].style.display="block":l[e].style.display="none"}}function input_Oninput(e){e.target.classList.remove("grid-value-moded"),e.target.classList.contains("grid-value-oninput")||e.target.classList.add("grid-value-oninput")}function input_PrefixPath_Set(e,t,n){if(!t||t.length<1||!n||n.length<1)return;const o=document.getElementById(e),l=document.getElementById(t),i=document.getElementById(n);o&&l&&i&&(i.textContent=o.value.startsWith("/")?l.value+o.value:l.value+"/"+o.value)}function input_PrefixPath_OnInput(e,t){t&&2==t.length&&input_PrefixPath_Set(e.target.id,t[0],t[1])}function input_PrefixOwner_OnInput(e,t){if(!params_Validate(t,"e",2))return;const n=document.getElementById(t[0]),o=document.getElementById(t[1]);if(n&&o){const t=n.value+"_";o.textContent=e.target.value.startsWith(t)?t+e.target.value.slice(t.length):t+e.target.value}}function select_RemoveOptions(e){for(let t=e.options.length-1;t>=0;t-=1)e.remove(t)}async function logPage_ShowLog(e,t){if(!params_Validate(t,"e",2))return;const n=document.querySelector(t[0]);if(!n||n.value.length<0)return void notificationNew_addError("entity is not selected");const o=t[1],l=document.querySelector("#"+o+"-log-access"),i=l&&l.checked?"access":"error",a=document.querySelector("#"+o+"-log-200"),c=document.querySelector("#"+o+"-log-500"),s=document.querySelector("#"+o+"-log-1000");let r="50";a&&a.checked?r="200":c&&c.checked?r="500":s&&s.checked&&(r="1000");const d=e.target.id,u=new ButtonState(d);let f=await fetchText_Get("/"+o+"/?a="+o+"-log-show&entity="+encodeURIComponent(n.value)+"&type="+i+"&rows="+r);if(u.restore(),!isFetchedDataValid(f))return;const g=document.getElementById(o+"-log-textarea");if(g){g.textContent=f;let e=0;for(let t=0;t<f.length;t++)"\n"==f[t]&&(e+=1);e+=1,g.rows=e.toString()}}function table_getSelectedIds(e){let t=[];const n=document.querySelectorAll("table#"+e+" tbody tr");for(let e=0;e<n.length;e+=1)n[e].querySelector(".checkbox-simple-cntr input[type=checkbox]").checked&&t.push({id:n[e].id,dataId:n[e].dataset.id});return t}function cache_AddNocacheParam(){return`nocache=${(new Date).getTime()}`}function csrf_getPageToken(){const e=document.getElementById("page-tkn");return e?e.value:""}async function table_deleteByIds(e,t){if(!params_Validate(t,"e",3))return;if("modal-submit"!==e.target.id)return;if(t[0].startsWith("/site/")){const e=document.getElementById("modal-site-delete-dir");e&&e.checked?t[1]="yes "+t[1]:t[1]="'' "+t[1]}else if(t[0].startsWith("/dbhost/")){const e=document.getElementById("modal-dbhost-delete-dir");e&&e.checked?t[1]="yes "+t[1]:t[1]="'' "+t[1]}const n=new ButtonState("modal-submit"),o=await fetchText_Delete(t[0]+"&t="+csrf_getPageToken(),t[1]);n.restore(),isFetchedOk(o,t[2])}async function table_openDeleteWnd(e,t){if(!params_Validate(t,"ge",6))return;const n=t[0],o=t[1],l=t[2],i=t[3],a=t[4],c=t[5],s=t[6],r=['<div class="row jc-between h-2"><p class="modal-title">'+i+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>\n'],d=table_getSelectedIds(n);if(d.length<1)return void notificationNew_addError("no rows selected");s&&"string"==typeof s&&r.push(s),r.push('<p class="d-block m-t1 m-b1">'+a+":</p>\n");const u=Array();for(let e=0;e<d.length;e+=1)u.push('"'+d[e].dataId+'"');r.push('<textarea class="w-100p h-5" readonly>'+Html.escape(u.join(" "))+"</textarea>"),r.push('<a id="modal-submit" class="btn">'+c+"</a>");const f=document.getElementById("modal-content");f&&(f.innerHTML=r.join("\n"));const g=document.getElementById("modal-popup");g&&(g.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close);const h=[];for(let e=0;e<d.length;e+=1)h.push(d[e].id);let m=h.join(",");m="'"+m.replaceAll("'","%QUO%")+"'",listener_AddSingleById("modal-submit","mouseup","keyup","Enter",table_deleteByIds,o,m,l)}function modal_Open(e,t){const n=document.getElementById("modal-popup");n&&(n.style.display="block")}function modal_Close(e,t){const n=document.getElementById("modal-content"),o=document.getElementById("modal-popup");if("Escape"===e.key)return o&&(o.style.display="none"),void(n&&(n.innerHTML=""));if(o&&e.target==o)return o.style.display="none",void(n&&(n.innerHTML=""));const l=document.getElementById("modal-close");if(l&&e.target==l)return o&&(o.style.display="none"),void(n&&(n.innerHTML=""));const i=document.getElementById("modal-submit");i&&e.target==i&&(o&&(o.style.display="none"),n&&(n.innerHTML=""))}async function modal_Common_delete(e,t){if(!params_Validate(t,"e",3))return;if("modal-submit"!==e.target.id)return;const n=new ButtonState("modal-submit"),o=await fetchText_Delete(t[1]+"&t="+csrf_getPageToken(),t[0]);n.restore(),isFetchedOk(o,t[2])}async function modal_Common_openDeleteWnd(e,t){if(!params_Validate(t,"e",6))return;const n=t[0],o=t[1],l=t[2],i=t[3],a=t[4],c=t[5],s=['<div class="row jc-between h-2"><p class="modal-title">'+i+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>\n'];s.push('<p class="d-block m-t1">'+a+":</p>\n"),s.push('<a id="modal-submit" class="btn m-t1">'+c+"</a>");const r=document.getElementById("modal-content");r&&(r.innerHTML=s.join("\n"));const d=document.getElementById("modal-popup");d&&(d.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close),listener_AddSingleById("modal-submit","mouseup","keyup","Enter",modal_Common_delete,n,o,l)}function notification_UpdateCounters(e){if(!e||"string"!=typeof e)return;const t=document.querySelector(".notification-ack-cnt");t&&(t.textContent=e);const n=document.querySelector(".notif-cnt");if(n){const t=e.split("/");n.setAttribute("data-after",t[0]),""!==t[0]&&"0"!==t[0]||n.classList.remove("unread")}}async function notification_AcknowledgeAll(e,t){const n=document.querySelector(".notification-scroll-container");if(n){const e=n.querySelectorAll(".notification-msg");if(e)for(let t=0;t<e.length;t+=1)e[t].classList.remove("expanded"),e[t].classList.remove("unread")}const o=await fetchText_Post("/notification/?a=notification-ack",-1);isFetchedDataValid(o)&&notification_UpdateCounters(o)}async function notification_Delete(e,t){const n=document.querySelector(".notification-scroll-container > ul");if(n){const e=n.querySelector(".notification-msg.expanded");if(e){const t=parseInt(e.id.replace("notification-msg-","")),n=await fetchText_Post("/notification/?a=notification-del",t);if(!isFetchedDataValid(n))return;e.remove(),notification_UpdateCounters(n)}}}async function notification_DeleteAll(e,t){const n=document.querySelector(".notification-scroll-container > ul");n&&(n.innerHTML="");const o=await fetchText_Post("/notification/?a=notification-del",-1);isFetchedDataValid(o)&&notification_UpdateCounters(o)}async function notification_Expand(e,t){const n="expanded",o=e.target.classList.contains(n),l=document.querySelector(".notification-scroll-container"),i=l?l.querySelectorAll(".notification-msg"):null;if(i)for(let e=0;e<i.length;e+=1)i[e].classList.remove(n);o||(e.target.classList.remove("unread"),e.target.classList.add(n));const a="notification-msg-";if(e.target.id.length>a.length){const t=e.target.id.substring(a.length);if(t&&t.length>0){const e=await fetchText_Post("/notification/?a=notification-ack",t);if(!isFetchedDataValid(e))return;notification_UpdateCounters(e)}}}async function notificationModal_OpenWnd(e,t){if("notification-open"!==e.target.id)return;const n=await fetchText_Get("/notification/?a=notification-get-all");if(!isFetchedDataValid(n))return;const o=document.getElementById("modal-content");o&&(o.innerHTML=n);const l=document.getElementById("modal-popup");l&&(l.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close),listener_AddSingleById("notification-ack-all","click","keyup","Enter",notification_AcknowledgeAll),listener_AddSingleById("notification-del","click","keyup","Enter",notification_Delete),listener_AddSingleById("notification-del-all","click","keyup","Enter",notification_DeleteAll),listeners_Add("#modal-content",".notification-msg","mouseup",null,null,notification_Expand),document.addEventListener("keyup",(function(e){"Escape"===e.key&&modal_Close(e,null)}),{once:!0})}async function notificationNew_Expand(e,t){const n="expanded",o=e.target.classList.contains(n),l=document.getElementById("notif-new-container");if(l){const e=l.querySelectorAll(".notif-new");if(e)for(let t=0;t<e.length;t+=1)e[t].classList.remove(n)}o||e.target.classList.add(n);const i="notif-new-";if(e.target.id.length>i.length){const t=e.target.id.substring(i.length);if(t&&t.length>0){const e=await fetchText_Post("/notification/?a=notification-ack",t);if(!isFetchedDataValid(e))return;notification_UpdateCounters(e)}}}async function notificationNew_Wider(e,t){const n=document.getElementById("notif-new-container");n&&(n.style.maxWidth="60rem")}async function notificationNew_Close(e,t){const n=document.getElementById("notif-new-container");if(!n)return;const o=n.querySelectorAll(".notif-new"),l=[];if(o){const e="notif-new-";for(let t=0;t<o.length;t+=1)o[t].id.length>e.length&&l.push(o[t].id.substring(e.length))}if(l&&l.length>0){const e=await fetchText_Post("/notification/?a=notification-ack",l.join(","));if(!isFetchedDataValid(e))return;notification_UpdateCounters(e)}n.innerHTML="",n.style.display="none"}function notificationNew_add(e,t){if(!e||"string"!=typeof e)return;const n=document.querySelector(".notif-new-container");if(!n)return;n.innerHTML.length<1&&(n.innerHTML='<span id="notif-new-container-wider" class="notif-new-container-wider">&laquo;</span><span id="notif-new-container-close" class="notif-new-container-close">&times;</span>',listener_AddSingleById("notif-new-container-wider","click",null,null,notificationNew_Wider),listener_AddSingleById("notif-new-container-close","click",null,null,notificationNew_Close));const o=n.querySelectorAll(".notif-new");if(o)if(o.length>10){for(let e=0;e<5;e+=1)o[e].remove();for(let e=5;e<o.length;e+=1)o[e].classList.remove("expanded")}else for(let e=0;e<o.length;e+=1)o[e].classList.remove("expanded");const l=document.createElement("div"),i=document.createTextNode(e);l.appendChild(i),t?l.classList.add("notif-new","expanded","err"):l.classList.add("notif-new","expanded"),n.appendChild(l),listeners_Add(".notif-new-container",".notif-new:last-of-type","click",null,null,notificationNew_Expand),"block"!=n.style.display&&(n.style.display="block")}function notificationNew_addError(e){notificationNew_add(e,!0)}async function header_LangSet(e,t){"header-lang"===e.target.id&&followPage("/user/?a=user-lang-set&lang="+encodeURIComponent(e.target.value),"")}class LangData{constructor(e){const t=document.getElementById(e);t&&"string"==typeof t.textContent?this.lang=JSON.parse(t.textContent):this.lang=null}raw(e){return this.lang&&this.lang[e]&&"string"==typeof this.lang[e]?this.lang[e]:e}esc(e){return this.lang&&this.lang[e]&&"string"==typeof this.lang[e]?Html.escape(this.lang[e]):Html.escape(e)}}async function logout(e,t){const n="logout",o=new IconButtonState(n),l=await fetchText_Post("/login/?a=logout","");o.restore(),isFetchedOkWithLink(l,"/site/")}function common_listeners(){listener_AddSingleById("filter-cat","input",null,null,input_SearchFilter,"a"),listeners_Add(".notif-new-container",".notif-new","click",null,null,notificationNew_Expand),listener_AddSingleById("notif-new-container-wider","click",null,null,notificationNew_Wider),listener_AddSingleById("notif-new-container-close","click",null,null,notificationNew_Close),listener_AddSingleById("header-lang","change",null,null,header_LangSet),listener_AddSingleById("notification-open","click","keyup","Enter",notificationModal_OpenWnd),listener_AddSingleById("logout","mouseup","keyup","Enter",logout)}