"use strict";const G_L=new LangData("db-lang");async function db_userTypeSelector(e,d){if(!params_Validate(d,"e",1))return;const t=d[0],r=e.target.id=="db-"+t+"-usersel-new",s=e.target.id=="db-"+t+"-usersel-exist";if(!r&&!s)return;const n=document.getElementById("db-"+t+"-user-name-eu");if(!n)return;const i=document.getElementById("db-"+t+"-user-name-nu"),l=document.getElementById("db-"+t+"-user-pass-nu"),a=document.getElementById("db-"+t+"-user-gen-nu"),u=document.getElementById("db-"+t+"-user-visible-nu"),b=document.getElementById("db-"+t+"-user-auth-plugin-nu");if(i&&l&&a&&u&&b)if(r&&e.target.checked)n.style.display="none",i.style.display="inline-block",l.style.display="inline-block",a.style.display="inline-block",u.style.display="inline-block",b.style.display="inline-block";else if(s&&e.target.checked){select_RemoveOptions(n);let e=document.createElement("option");e.value="",e.text=G_L.raw("none"),e.checked=!0,n.add(e);const d=document.getElementById("db-"+t+"-server");if(d){const e=await fetchText_Get("/db/?a=db-users-list&dbhost="+encodeURIComponent(d.value));if(!isFetchedDataValid(e))return;const t=e.split(",");for(let e=0;e<t.length;e+=1){let d=document.createElement("option");d.value=t[e],d.text=t[e],d.checked=!1,n.add(d)}}n.style.display="inline-block",i.style.display="none",l.style.display="none",a.style.display="none",u.style.display="none",b.style.display="none"}}async function db_dbServerSelector(e,d){if("db-add-server"!=e.target.id)return;const t=document.getElementById("db-add-usersel-new"),r=document.getElementById("db-add-usersel-exist");if(!t||!r)return;const s=document.getElementById("db-add-user-name-eu");if(!s)return;const n=document.getElementById("db-add-user-name-nu"),i=document.getElementById("db-add-user-pass-nu"),l=document.getElementById("db-add-user-gen-nu"),a=document.getElementById("db-add-user-visible-nu"),u=document.getElementById("db-add-user-auth-plugin-nu");n&&i&&l&&a&&u&&(t.checked=!0,r.checked=!1,s.style.display="none",n.style.display="inline-block",i.style.display="inline-block",l.style.display="inline-block",a.style.display="inline-block",u.style.display="inline-block")}async function db_confirmAdd(e,d){const t=new PrepData(7);let r=!1;if(t.prepareValue(0,"#db-add-server",!0,G_L.raw("db host")+" "+G_L.raw("is required"))||(r=!0),t.prepareValue(2,"#db-add-name",!0,G_L.raw("db name")+" "+G_L.raw("is required"))||(r=!0),r)return;if(!t.prepareValue(1,"#db-add-charset",!1,""))return;const s=new PrepData(0);if(!s.prepareRadio(0,["#db-add-usersel-new","#db-add-usersel-exist"]))return;if("'usersel-new'"===s.arr[0]){if(!t.prepareValue(3,"#db-add-user-name-nu",!0,G_L.raw("db user")+" "+G_L.raw("is required"))||!t.prepareValue(4,"#db-add-user-pass-nu",!0,G_L.raw("password")+" "+G_L.raw("is required"))||!t.prepareValue(5,"#db-add-user-auth-plugin-nu",!1,""))return}else{if("'usersel-exist'"!==s.arr[0])return;if(!t.prepareValue(3,"#db-add-user-name-eu",!0,G_L.raw("db user")+" "+G_L.raw("is required")))return}if(!t.agregateChecked(6,["#db-add-user-priv-all","#db-add-user-priv-alter","#db-add-user-priv-alter-routine","#db-add-user-priv-create","#db-add-user-priv-create-routine","#db-add-user-priv-create-view","#db-add-user-priv-delete","#db-add-user-priv-drop","#db-add-user-priv-execute","#db-add-user-priv-index","#db-add-user-priv-insert","#db-add-user-priv-lock-tables","#db-add-user-priv-references","#db-add-user-priv-select","#db-add-user-priv-show-view","#db-add-user-priv-trigger","#db-add-user-priv-update"],[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536]))return;const n="db-add-confirm",i=new ButtonState(n),l=await fetchText_Post("/db/?a="+n,t.arr.join(" "));i.restore(),isFetchedOk(l,"/db/")}async function db_confirmUserAdd(e,d){const t=new PrepData(6);let r=!1;if(t.prepareValue(0,"#db-edit-server",!0,G_L.raw("db host")+" "+G_L.raw("is required"))||(r=!0),t.prepareValue(1,"#db-edit-name",!0,G_L.raw("db name")+" "+G_L.raw("is required"))||(r=!0),r)return;const s=new PrepData(1);if(!s.prepareRadio(0,["#db-edit-usersel-new","#db-edit-usersel-exist"]))return;if("'usersel-new'"===s.arr[0]){if(!t.prepareValue(2,"#db-edit-user-name-nu",!0,G_L.raw("db user")+" "+G_L.raw("is required"))||!t.prepareValue(3,"#db-edit-user-pass-nu",!0,G_L.raw("password")+" "+G_L.raw("is required"))||!t.prepareValue(4,"#db-edit-user-auth-plugin-nu",!1,G_L.raw("authentication plugin is not set")))return}else{if("'usersel-exist'"!==s.arr[0])return;if(!t.prepareValue(2,"#db-edit-user-name-eu",!0,G_L.raw("db user")+" "+G_L.raw("is required")))return}if(!t.agregateChecked(5,["#db-edit-user-priv-all","#db-edit-user-priv-alter","#db-edit-user-priv-alter-routine","#db-edit-user-priv-create","#db-edit-user-priv-create-routine","#db-edit-user-priv-create-view","#db-edit-user-priv-delete","#db-edit-user-priv-drop","#db-edit-user-priv-execute","#db-edit-user-priv-index","#db-edit-user-priv-insert","#db-edit-user-priv-lock-tables","#db-edit-user-priv-references","#db-edit-user-priv-select","#db-edit-user-priv-show-view","#db-edit-user-priv-trigger","#db-edit-user-priv-update"],[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536]))return;const n=e.target.id,i=new IconButtonState(n),l=await fetchText_Post("/db/?a="+n,t.arr.join(" "));i.restore(),isFetchedOk(l,window.location.href)}async function db_confirmUserSet(e,d){if(!params_Validate(d,"e",2))return;const t=d[0],r=d[1];if(e.target.id!=t+":"+r)return;const s=new PrepData(5);let n=!1;if(s.prepareValue(0,"#db-edit-server",!0,G_L.raw("db host")+" "+G_L.raw("is required"))||(n=!0),s.prepareValue(1,"#db-edit-name",!0,G_L.raw("db name")+" "+G_L.raw("is required"))||(n=!0),s.prepareValue(2,"#db-edit-user-name\\:"+r,!0,G_L.raw("db user")+" "+G_L.raw("is required"))||(n=!0),n)return;if(!s.prepareValue(3,"#db-edit-user-pass\\:"+r,!1,""))return;if(!s.agregateChecked(4,["#db-edit-user-priv-all\\:"+r,"#db-edit-user-priv-alter\\:"+r,"#db-edit-user-priv-alter-routine\\:"+r,"#db-edit-user-priv-create\\:"+r,"#db-edit-user-priv-create-routine\\:"+r,"#db-edit-user-priv-create-view\\:"+r,"#db-edit-user-priv-delete\\:"+r,"#db-edit-user-priv-drop\\:"+r,"#db-edit-user-priv-execute\\:"+r,"#db-edit-user-priv-index\\:"+r,"#db-edit-user-priv-insert\\:"+r,"#db-edit-user-priv-lock-tables\\:"+r,"#db-edit-user-priv-references\\:"+r,"#db-edit-user-priv-select\\:"+r,"#db-edit-user-priv-show-view\\:"+r,"#db-edit-user-priv-trigger\\:"+r,"#db-edit-user-priv-update\\:"+r],[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536]))return;const i=new IconButtonState(t),l=await fetchText_Post("/db/?a="+t,s.arr.join(" "));i.restore(),isFetchedOk(l,window.location.href)}function db_dbuser_OpenDeleteWnd(e,d){if(!params_Validate(d,"e",4))return;const t=d[0],r=d[1],s=d[2],n=d[3];if(r.length<1)return void notificationNew_addError("database user is not set for deletion");if(e.target.id!=t+":"+r)return;const i=document.getElementById(s),l=i?i.value:"",a=document.getElementById(n),u=a?a.value:"";if(l.length<1||u.length<1)return void notificationNew_addError("failed to determine database and host");const b=['<div class="row jc-between h-2"><p class="modal-title">'+G_L.esc("Delete database user")+'</p><span id="modal-close" class="modal-close">&times;</span></div><hr>\n'];b.push('<p class="d-block m-t1">'+G_L.esc("Next items will be deleted")+":</p>\n"),b.push('<p class="d-block w-100p h-5 m-t1"><span class="c-redlight f-1">'+Html.escape(r)+'</span><span class="c-cc f-1">@'+Html.escape(l)+"</span></p>"),b.push('<a id="modal-submit" class="btn">'+G_L.esc("Confirm")+"</a>");const o=document.getElementById("modal-content");o&&(o.innerHTML=b.join("\n"));const c=document.getElementById("modal-popup");c&&(c.style.display="block"),modal_Open(null,null),listener_AddSingleById("modal-close","mouseup",null,null,modal_Close),listener_AddSingleById("modal-popup","mouseup",null,null,modal_Close);const p=new PrepData(3);p.prepareString(0,u)&&p.prepareString(1,r)&&p.prepareString(2,l)&&listener_AddSingleById("modal-submit","mouseup","keyup","Enter",table_deleteByIds,"/db/?a=db-user-delete",p.arr.join(" "),window.location.href)}function db_dbuser_privilegedDbusers_ListenersAdd(){const e=document.querySelectorAll("[id^=db-edit-user-cntr-user-set\\:]");if(!e)return void console.log("failed to find db users");for(let d=0;d<e.length;d+=1){const t=e[d].id.slice("db-edit-user-cntr-user-set:".length);if(!t||t.length<1)return void console.log("failed to identify db user id");listener_AddSingleById("db-edit-user-set:"+t,"click",null,null,db_confirmUserSet,"db-edit-user-set",t),listener_AddSingleById("db-edit-user-gen:"+t,"click",null,null,button_passwordGen,"db-edit-user-pass:"+t),listener_AddSingleById("db-edit-user-visible:"+t,"click",null,null,button_togglePasswordVisible,"db-edit-user-pass:"+t),listener_AddSingleById("db-edit-user-delete:"+t,"click","keyup","Enter",db_dbuser_OpenDeleteWnd,"db-edit-user-delete",t,"db-edit-server","db-edit-name")}}common_listeners(),listener_AddSingleById("db-edit","click","keyup","Enter",table_OnButtonClick_Router,"tbl-db","/db/?a=db-edit&db=",""),listener_AddSingleById("db-on","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-db","/db/?a=db-on","/db/",""),listener_AddSingleById("db-off","click","keyup","Enter",table_RunPostOnButtonClick_MultiRouter,"tbl-db","/db/?a=db-off","/db/",""),listener_AddSingleById("db-delete-wnd","click","keyup","Enter",table_openDeleteWnd,"tbl-db","/db/?a=db-delete","/db/",G_L.esc("Delete")+" "+G_L.esc("databases"),G_L.esc("Next items will be deleted"),G_L.esc("Confirm"),null),listener_AddSingleById("db-add-server","change",null,null,db_dbServerSelector,null),listener_AddSingleById("db-add-usersel-new","change",null,null,db_userTypeSelector,"add"),listener_AddSingleById("db-add-usersel-exist","change",null,null,db_userTypeSelector,"add"),listener_AddSingleById("db-add-user-gen-nu","click",null,null,button_passwordGen,"db-add-user-pass-nu"),listener_AddSingleById("db-add-user-visible-nu","click",null,null,button_togglePasswordVisible,"db-add-user-pass-nu"),listener_AddSingleById("db-add-confirm","click",null,null,db_confirmAdd,null),listener_AddSingleById("db-edit-usersel-new","change",null,null,db_userTypeSelector,"edit"),listener_AddSingleById("db-edit-usersel-exist","change",null,null,db_userTypeSelector,"edit"),listener_AddSingleById("db-edit-user-add","click",null,null,db_confirmUserAdd),listener_AddSingleById("db-edit-user-gen-nu","click",null,null,button_passwordGen,"db-edit-user-pass-nu"),listener_AddSingleById("db-edit-user-visible-nu","click",null,null,button_togglePasswordVisible,"db-edit-user-pass-nu"),db_dbuser_privilegedDbusers_ListenersAdd(),listeners_Add("table.tbl-fixed tbody","tr","mouseup",null,null,table_OnClickRouter,"/db/?a=db-edit&db="),listener_AddSingleById("db-name-sort","click",null,null,table_Sort,"/db/","db-table-sort","sort-no,sort-name-az,sort-name-za"),listener_AddSingleById("db-host-sort","click",null,null,table_Sort,"/db/","db-table-sort","sort-no,sort-host-az,sort-host-za"),listener_AddSingleById("dbs-checkbox-header","mouseup",null,null,table_SetAllCheckboxes,"table#tbl-db tbody tr td .checkbox-simple-cntr input[type=checkbox]"),listeners_Add(null,".pageidx","click",null,null,table_SelectPage,"db-table-page","/db/"),listener_AddSingleById("db-table-setting","click","keyup","Enter",tableSetting_Modal_OpenWnd,JSON.stringify({id:"db-table-setting",cookie:"db-table-setting",path:"/db/",titles:[G_L.esc("Settings"),G_L.esc("Number of rows"),G_L.esc("custom"),G_L.esc("Confirm")],values:[1,2,4,8],names:["database","host","version","dbusers"],labels:[G_L.esc("database"),G_L.esc("host"),G_L.esc("version"),G_L.esc("db users")]}));